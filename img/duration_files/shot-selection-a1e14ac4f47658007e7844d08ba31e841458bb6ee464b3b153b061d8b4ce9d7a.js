var Dribbble=Dribbble||{};Dribbble.ShotSelection={init:function(t){this.formContainer=t.formContainer,this.addRemoveInfo=t.addRemoveInfo,this.noHideOnEdit=t.noHideOnEdit,this.bindEventListeners()},bindEventListeners:function(){$(".stream input").on("change",this.streamChange.bind(this)),this.formContainer.find("form :input").on("change",function(){this.unsavedChanges()}.bind(this)),Dribbble.SingleSubmit.bind(this.formContainer.find("form")),$("a.add-shots").on("click",this.enableShotSelection.bind(this)),$(".selectable .select-shot a.selection-icon").on("click",this.selectShot.bind(this)),$(".selectable .selected-shot a.selection-icon").on("click",this.deselectShot.bind(this)),$("#main").on("dragstart",".draggable li:not(.select-shot)",this.shotDragStart.bind(this)).on("dragenter",".draggable li:not(#drag-temp, .dragging)",this.shotDragEnter.bind(this)).on("dragover",".draggable li#drag-temp",this.shotDragOver.bind(this)).on("dragleave",".draggable #drag-temp",this.shotDragLeave.bind(this)).on("dragend",".draggable li",this.shotDragEnd.bind(this)).on("drop",".draggable li#drag-temp",this.shotDrop.bind(this)),$("ol.dribbbles").on("click",".move-up",this.moveShotUp.bind(this)),$("ol.dribbbles").on("click",".move-down",this.moveShotDown.bind(this)),$(".done-editing").on("click",this.disableEditing.bind(this))},streamChange:function(t){"custom"==$(t.currentTarget).val()&&0==this.customShotIds().length?this.enableShotSelection():this.refreshShots()},enableShotSelection:function(){var t=$(".shot-size input:checked").val(),e=window.location.pathname+"?stream=recent&draggable=1&shotsize="+t+"&shot_ids="+this.customShotIds().join(",");return Dribbble.Screenshots.refreshList(e),$("ol.dribbbles").addClass("selectable").addClass("draggable"),this.noHideOnEdit||this.formContainer.fadeOut(200),this.addRemoveInfo&&this.addRemoveInfo.show(),!1},selectShot:function(t){var e=$(t.currentTarget).parents("li"),n=e.modelId();return e.removeClass("select-shot").addClass("selected-shot").attr("draggable","true"),$("#custom_shots").append(this.customShotInput(n)),this.unsavedChanges(),!1},deselectShot:function(t){var e=$(t.currentTarget).parents("li"),n=e.modelId();return e.removeClass("selected-shot").addClass("select-shot").attr("draggable","false"),$("#custom_shots input[value="+n+"]").remove(),this.unsavedChanges(),!1},shotDragStart:function(t){$(t.currentTarget).addClass("dragging"),t.originalEvent.dataTransfer.effectAllowed="move",t.originalEvent.dataTransfer.setData("text/plain",$(t.currentTarget).attr("id"))},shotDragEnter:function(t){var e='<li id="drag-temp" class="group"></li>';window.clearTimeout(this.removeTimeout),$(t.currentTarget).nextAll("#drag-temp").length?($("#drag-temp").remove(),$(t.currentTarget).before(e)):$(t.currentTarget).prevAll("#drag-temp").length?($("#drag-temp").remove(),$(t.currentTarget).after(e)):($("#drag-temp").remove(),$(t.currentTarget).before(e))},shotDragOver:function(t){return t.originalEvent.dataTransfer.dropEffect="move",!1},shotDragLeave:function(){this.removeTimeout=window.setTimeout(function(){$("#drag-temp").remove()},100)},shotDragEnd:function(t){$(t.currentTarget).removeClass("dragging"),$("#drag-temp").remove()},shotDrop:function(t){var e=$("#"+t.originalEvent.dataTransfer.getData("text/plain")),n=e.modelId(),s=$($(t.currentTarget).prevAll("li")[0]);if($(t.currentTarget).replaceWith(e.prop("outerHTML")),e.remove(),$(".dragging").removeClass("dragging"),e.hasClass("select-shot"))return!1;if($("#custom_shots input[value="+n+"]").remove(),s[0]){var r=$("#custom_shots input[value="+s.modelId()+"]");r[0]?r.after(this.customShotInput(n)):$("#custom_shots").prepend(this.customShotInput(n))}else $("#custom_shots").prepend(this.customShotInput(n));return this.unsavedChanges(),!1},moveShotUp:function(t){var e=$(t.currentTarget).parents("li"),n=e.modelId(),s=$(e.prevAll("li")[0]);if(s.before(e),s.hasClass("select-shot"))return!1;var r=this.formContainer.find("#custom_shots input[value="+n+"]");return $(r.prevAll("input")[0]).before(r),this.unsavedChanges(),!1},moveShotDown:function(t){var e=$(t.currentTarget).parents("li"),n=e.modelId(),s=$(e.nextAll("li")[0]);if(s.after(e),s.hasClass("select-shot"))return!1;var r=this.formContainer.find("#custom_shots input[value="+n+"]");return $(r.nextAll("input")[0]).after(r),this.unsavedChanges(),!1},refreshShots:function(t){var e=$(".stream input:checked").val(),n=$(".shot-size input:checked").val(),s=window.location.pathname+"?stream="+e+"&shotsize="+n;t!==undefined&&(s+="&draggable=1"),"custom"==e&&(s+="&shot_ids="+this.customShotIds().join(",")),Dribbble.Screenshots.refreshList(s)},customShotIds:function(){return $('input[name="custom_shots[]"]').map(function(){return $(this).val()}).toArray()},customShotInput:function(t){return'<input type="hidden" name="custom_shots[]" id="custom_shot_'+t+'" value="'+t+'">'},disableEditing:function(){return this.addRemoveInfo&&this.addRemoveInfo.hide(),this.sortingInfo&&this.sortingInfo.hide(),$("ol.dribbbles").removeClass("selectable").removeClass("draggable"),this.formContainer.fadeIn(200),this.refreshShots(),!1},unsavedChanges:function(){$("#save-button").attr("disabled")&&($("#save-button").prop("disabled",!1),$(".action-buttons").show(),$(window).on("beforeunload",function(t){var e="You have unsaved changes that will be lost if you leave.";return t.returnValue=e}))}};